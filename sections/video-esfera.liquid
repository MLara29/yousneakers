{% assign sid = section.id %}
{% style %}
.floating-video-sphere-{{ sid }}{position:fixed;left:16px;bottom:90px;width:140px;height:180px;border-radius:50%;border:3px solid {{ settings.accent_color }};overflow:hidden;box-shadow:0 8px 20px rgba(0,0,0,.25);background:#000;z-index:9999;cursor:grab}
.floating-video-sphere-{{ sid }}.dragging{cursor:grabbing}
.floating-video-sphere-{{ sid }} video{width:100%;height:100%;object-fit:cover;border-radius:50%}
.floating-video-close-{{ sid }}{position:absolute;top:6px;right:6px;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.85);border:2px solid {{ settings.accent_color }};color:{{ settings.accent_color }};font-weight:700;font-size:14px;line-height:1;cursor:pointer;z-index:2}
@media(max-width:640px){.floating-video-sphere-{{ sid }}{width:110px;height:110px;left:12px;bottom:80px}}
{% endstyle %}

<div class="floating-video-sphere-{{ sid }}" id="video-sphere-{{ sid }}">
  <div style="width:100%;height:100%;position:relative">
    <button type="button" class="floating-video-close-{{ sid }}" aria-label="Fechar">×</button>
    <video autoplay muted playsinline loop></video>
  </div>
  <script>
  (function(){
    var sphere=document.getElementById('video-sphere-{{ sid }}');
    if(!sphere) return;
    var v=sphere.querySelector('video');
    var urls=[
      'https://cdn.shopify.com/videos/c/o/v/def24781da1541e69d7f79af41c1537b.mp4',
      'https://cdn.shopify.com/videos/c/o/v/b2cc891d4b7941c58d4e81c52f2a0ebf.mp4',
      'https://cdn.shopify.com/videos/c/o/v/9be9b2fa90374b26a3debbb027caf9f8.mp4',
      'https://cdn.shopify.com/videos/c/o/v/5cc17f230f0f4342ade6d5939416001b.mp4',
      'https://cdn.shopify.com/videos/c/o/v/a8cafd97fc9148098c533f2b3088a42e.mp4',
      'https://cdn.shopify.com/videos/c/o/v/db631afedf78475daa8b3dc3bdc3a390.mp4',
      'https://cdn.shopify.com/videos/c/o/v/583d9b1c8b854e8b8620918612830aa9.mp4',
      'https://cdn.shopify.com/videos/c/o/v/f22a508bb5e24160ab11e3640ab101b1.mp4',
      'https://cdn.shopify.com/videos/c/o/v/cde83aa3412b4ac188c5f841906a40f9.mp4',
      'https://cdn.shopify.com/videos/c/o/v/8776ba5c7e5040c28ab5e182f3d2d6aa.mp4'
    ];
    var i=0;function setSrc(){v.src=urls[i];try{v.play()}catch(e){}}
    setSrc();
    v.addEventListener('ended',function(){i=(i+1)%urls.length;setSrc()});
    var to=setInterval(function(){i=(i+1)%urls.length;setSrc()},15000);
    var close=sphere.querySelector('.floating-video-close-{{ sid }}');
    if(close){close.addEventListener('click',function(e){e.preventDefault();try{clearInterval(to)}catch(_e){};try{sphere.remove()}catch(__e){if(sphere&&sphere.parentNode)sphere.parentNode.removeChild(sphere)}})}

    var dragging=false,offsetX=0,offsetY=0;
    function start(x,y){dragging=true;sphere.classList.add('dragging');var r=sphere.getBoundingClientRect();offsetX=x-r.left;offsetY=y-r.top;sphere.style.right='';sphere.style.bottom='';sphere.style.position='fixed';sphere.style.top=r.top+'px';sphere.style.left=r.left+'px'}
    function move(x,y){if(!dragging) return;var w=window.innerWidth,h=window.innerHeight,sw=sphere.offsetWidth,sh=sphere.offsetHeight,nx=x-offsetX,ny=y-offsetY;if(nx<0) nx=0;if(ny<0) ny=0;if(nx>w-sw) nx=w-sw;if(ny>h-sh) ny=h-sh;sphere.style.left=nx+'px';sphere.style.top=ny+'px'}
    function end(){if(!dragging) return;dragging=false;sphere.classList.remove('dragging')}
    sphere.addEventListener('mousedown',function(e){if(e.target&&e.target.closest('.floating-video-close-{{ sid }}')) return;e.preventDefault();start(e.clientX,e.clientY)});
    document.addEventListener('mousemove',function(e){move(e.clientX,e.clientY)});
    document.addEventListener('mouseup',end);
    sphere.addEventListener('touchstart',function(e){var t=e.touches[0];if(e.target&&e.target.closest('.floating-video-close-{{ sid }}')) return;start(t.clientX,t.clientY)},{passive:true});
    document.addEventListener('touchmove',function(e){var t=e.touches[0];move(t.clientX,t.clientY)},{passive:true});
    document.addEventListener('touchend',end);
  })();
  </script>
</div>

{% schema %}
{
  "name": "Vídeo Esfera",
  "settings": [
    {"type":"text","id":"title","label":"Título","default":"Vídeo Esfera"}
  ],
  "presets": [
    {"category":"Video","name":"Vídeo Esfera"}
  ]
}
{% endschema %}
